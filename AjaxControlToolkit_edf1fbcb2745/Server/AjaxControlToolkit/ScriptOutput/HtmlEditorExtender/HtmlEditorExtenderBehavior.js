// (c) 2010 CodePlex Foundation
(function(){var b="HtmlEditorExtenderBehavior";function a(){var n="ToolbarButtons",m="BackColor",l="ForeColor",c="on",j="blur",k="select",h="button",f="input",e=true,d="unselectable",g="div",b=false,a=null;Type.registerNamespace("Sys.Extended.UI");Sys.Extended.UI.HtmlEditorExtenderBehavior=function(m){var j="ajax__html_editor_extender_button",i="px",c=this;Sys.Extended.UI.HtmlEditorExtenderBehavior.initializeBase(c,[m]);c._textbox=Sys.Extended.UI.TextBoxWrapper.get_Wrapper(m);var l=c.get_id();c._backColor=a;c._foreColor=a;c._commandName=a;c.savedRange=a;c.isInFocus=a;_flag=b;c._ButtonWidth=23;c._ButtonHeight=21;c._containerTemplate={nodeName:g,properties:{id:l+"_ExtenderContainer"},cssClasses:[d,"ajax__html_editor_extender_container"]};c._editableTemplate={nodeName:g,properties:{id:l+"_ExtenderContentEditable",style:{height:"80%",overflow:"auto",clear:"both"},contentEditable:e},cssClasses:["ajax__html_editor_extender_texteditor"]};c._buttonTemplate={nodeName:f,properties:{type:h,style:{width:c._ButtonWidth+i,height:c._ButtonHeight+i}},cssClasses:[j]};c._textboxTemplate={nodeName:f,properties:{type:"text"}};c._dropDownTemplate={nodeName:k,properties:{style:{width:c._ButtonWidth+i,height:c._ButtonHeight+i}},cssClasses:[j]};c._topButtonContainerTemplate={nodeName:g,properties:{id:l+"_ExtenderButtonContainer"},cssClasses:["ajax__html_editor_extender_buttoncontainer"]};c._container=a;c._toolbarButtons=a;c._editableDiv=a;c._topButtonContainer=a;c._buttons=[];c._btnClickHandler=a;c._requested_buttons=[];c._colorPicker=a;c._txtBoxForColor=a;if(typeof WebForm_OnSubmit=="function"&&!Sys.Extended.UI.HtmlEditorExtenderBehavior._originalWebForm_OnSubmit){Sys.Extended.UI.HtmlEditorExtenderBehavior._originalWebForm_OnSubmit=WebForm_OnSubmit;WebForm_OnSubmit=Sys.Extended.UI.HtmlEditorExtenderBehavior.WebForm_OnSubmit}};Sys.Extended.UI.HtmlEditorExtenderBehavior.prototype={initialize:function(){var b=this;Sys.Extended.UI.HtmlEditorExtenderBehavior.callBaseMethod(b,"initialize");var h=0;b._button_list=[];b._createContainer();b._createTopButtonContainer();b._createEditableDiv();b._createButton();var c=b._textbox._element.parentNode;while(c!=a&&c.nodeName!="FORM")c=c.parentNode;if(c==a)throw"Missing Form tag";var f=Function.createDelegate(b,b._textBox_onblur),d=Function.createDelegate(b,b._editableDiv_onblur),g=Function.createDelegate(b,b._executeCommand);$addHandler(b._textbox._element,j,f,e);$addHandler(b._editableDiv,j,d,e);$addHandler(b._topButtonContainer,"click",g)},_dispose:function(){$removeHandler(this._textbox._element,j,delTextBox_onblur);$removeHandler(this._editableDiv,j,delEditableDiv_onblur);$removeHandler(_topButtonContainer,"click",btnClickHandler);Sys.Extended.UI.HtmlEditorExtenderBehavior.callBaseMethod(this,"dispose")},_createContainer:function(){var a=this,c=a.get_element();a._container=$common.createElementFromTemplate(a._containerTemplate,c.parentNode);var b=$common.getBounds(a._textbox._element);$common.setSize(a._container,{width:b.width,height:b.height});$common.wrapElement(a._textbox._element,a._container,a._container)},_createTopButtonContainer:function(){this._topButtonContainer=$common.createElementFromTemplate(this._topButtonContainerTemplate,this._container)},_createButton:function(){var s="ajax__html_editor_extender_button ajax__html_editor_extender_",r="21px",o="transparent",u="solid 1px #c2c2c2",q="Arial",p="11px",g="left",j="span",e=this,w=Sys.Browser.agent==Sys.Browser.InternetExplorer;for(i=0;i<e._toolbarButtons.length;i++){var n;if(e._toolbarButtons[i].CommandName=="HorizontalSeparator")n=$common.createElementFromTemplate({nodeName:j,cssClasses:["ajax__html_editor_extender_separator"]},e._topButtonContainer);else if(e._toolbarButtons[i].CommandName=="FontName"){n=$common.createElementFromTemplate({nodeName:"nobr",properties:{style:{"float":g,cssFloat:g,fontSize:p}},cssClasses:["fontnameclass"],children:[{nodeName:j,properties:{textContent:"Font ",innerText:"Font ",style:{paddingLeft:"5px",fontWeight:"bold"}}}]},e._topButtonContainer);_select=$common.createElementFromTemplate({nodeName:k,properties:{style:{fontSize:"9px",fontFamily:q,height:"20px",width:"90px"}},events:{change:function(){var a=this.options[this.selectedIndex].value;setTimeout(function(){document.execCommand("fontname",b,a)},200)}}},n);var v=[{Text:q,Value:"arial,helvetica,sans-serif"},{Text:"Courier New",Value:"courier new,courier,monospace"},{Text:"Georgia",Value:"georgia,times new roman,times,serif"},{Text:"Tahoma",Value:"tahoma,arial,helvetica,sans-serif"},{Text:"Times New Roman",Value:"times new roman,times,serif"},{Text:"Verdana",Value:"verdana,arial,helvetica,sans-serif"},{Text:"Impact",Value:"impact"},{Text:"WingDings",Value:"wingdings"}];for(x in v){var t=document.createElement("option");t.text=v[x].Text;t.value=v[x].Value;try{_select.add(t,a)}catch(z){_select.add(t)}}_select.setAttribute("id",e._id+e._toolbarButtons[i].CommandName);_select.setAttribute("name",e._toolbarButtons[i].CommandName);_select.setAttribute("title",e._toolbarButtons[i].Tooltip);_select.setAttribute(d,c)}else if(e._toolbarButtons[i].CommandName=="FontSize"){n=$common.createElementFromTemplate({nodeName:"nobr",properties:{style:{"float":g,cssFloat:g,fontSize:p}},cssClasses:["fontsizeclass"],children:[{nodeName:j,properties:{textContent:"Size ",innerText:"Size ",style:{paddingLeft:"5px",fontWeight:"bold"}}}]},e._topButtonContainer);_select=$common.createElementFromTemplate({nodeName:k,properties:{style:{fontSize:p,fontFamily:q,height:"20px",width:w?"30px":"50px"}},events:{change:function(){var a=this.options[this.selectedIndex].value;setTimeout(function(){document.execCommand("fontsize",b,a)},200)}}},n);var v=[{Text:"1",Value:"1"},{Text:"2",Value:"2"},{Text:"3",Value:"3"},{Text:"4",Value:"4"},{Text:"5",Value:"5"},{Text:"6",Value:"6"},{Text:"7",Value:"7"}];for(x in v){var t=document.createElement("option");t.text=v[x].Text;t.value=v[x].Value;try{_select.add(t,a)}catch(z){_select.add(t)}}_select.setAttribute("id",e._id+e._toolbarButtons[i].CommandName);_select.setAttribute("name",e._toolbarButtons[i].CommandName);_select.setAttribute("title",e._toolbarButtons[i].Tooltip);_select.setAttribute(d,c)}else if(e._toolbarButtons[i].CommandName==l){n=$common.createElementFromTemplate({nodeName:j,properties:{style:{backgroundColor:"#ff0000",border:u,display:"block","float":g,cssFloat:g}},cssClasses:["forecolorclass"]},e._topButtonContainer);n.setAttribute(d,c);e._foreColor=$common.createElementFromTemplate({nodeName:f,properties:{type:h,id:e._id+e._toolbarButtons[i].CommandName,name:e._toolbarButtons[i].CommandName,title:e._toolbarButtons[i].Tooltip,style:{backgroundColor:o,width:r,height:"19px",color:o}},cssClasses:[s+e._toolbarButtons[i].CommandName]},n);e._foreColor.setAttribute(d,c)}else if(e._toolbarButtons[i].CommandName==m){n=$common.createElementFromTemplate({nodeName:j,properties:{style:{backgroundColor:"#ff0000",border:u,display:"block","float":g,cssFloat:g}},cssClasses:["backcolorclass"]},e._topButtonContainer);n.setAttribute(d,c);e._backColor=$common.createElementFromTemplate({nodeName:f,properties:{type:h,id:e._id+e._toolbarButtons[i].CommandName,name:e._toolbarButtons[i].CommandName,title:e._toolbarButtons[i].Tooltip,style:{backgroundColor:o,width:r,height:"19px",color:o}},cssClasses:[s+e._toolbarButtons[i].CommandName]},n);e._backColor.setAttribute(d,c)}else{var y={Copy:1,Cut:1,Paste:1};if(!(Sys.Browser.agent!=Sys.Browser.InternetExplorer&&y[e._toolbarButtons[i].CommandName])){n=$common.createElementFromTemplate({nodeName:f,properties:{type:h,id:e._id+e._toolbarButtons[i].CommandName,name:e._toolbarButtons[i].CommandName,title:e._toolbarButtons[i].Tooltip,style:{width:"23px",height:r}},cssClasses:[s+e._toolbarButtons[i].CommandName]},e._topButtonContainer);n.setAttribute(d,c)}Array.add(e._buttons,n)}}},_createEditableDiv:function(){var a=this;a._editableDiv=$common.createElementFromTemplate(a._editableTemplate,a._container);a._editableDiv.innerHTML=a._textbox._element.value;$common.setVisible(a._textbox._element,b)},_editableDiv_onblur:function(){this._textbox._element.value=this._encodeHtml()},_textBox_onblur:function(){this._editableDiv.innerHTML=this._textbox._element.value},_attributes:{style:"st_yle_",size:"si_ze_",color:"co_lor_",face:"fa_ce_",align:"al_ign_"},_rgbToHex:function(b){var a=/rgb\s?\(\s?(\d+)\s?,\s?(\d+)\s?,\s?(\d+)\s?\)/.exec(b);return"#"+(parseInt(a[3],10)|parseInt(a[2],10)<<8|parseInt(a[1],10)<<16).toString(16)},_encodeHtml:function(){for(var e=Sys.Browser.agent==Sys.Browser.InternetExplorer,d=this._editableDiv.getElementsByTagName("*"),k=d.length,b,j,i,f=0;b=d[f];f++){try{b.className="";b.removeAttribute("class")}catch(l){}try{b.id="";b.removeAttribute("id")}catch(l){}try{b.removeAttribute("width")}catch(l){}e}var a=this._editableDiv.innerHTML;if(e){var g=/\<[^\>]+\>/g;a=a.replace(g,function(c){var b=/\=\'([^\'])*\'/g,a=/\=([^\"][^\s\/\>]*)/g;return c.replace(b,'="$1"').replace(a,'="$1"')})}var h=this._rgbToHex,c=function(){a=a.replace(/(\<[^\>]+)(rgb\s?\(\d{1,3}\s?\,\s?\d{1,3}\s?\,\s?\d{1,3}\s?\))([^\>]*\>)/gi,function(d,b,a,c){return(b||"")+(a&&h(a)||"")+(c||"")})};c();c();a=a.replace(/\sclass\=\"\"/gi,"").replace(/\sid\=\"\"/gi,"");a=a.replace(/\<(\/?)strong\>/gi,"<$1b>").replace(/\<(\/?)em\>/gi,"<$1i>");a=a.replace(/&/ig,"&amp;").replace(/\xA0/ig,"&nbsp;");a=a.replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\'/ig,"&apos;").replace(/\"/ig,"&quot;");return a},_editableDiv_submit:function(){var c=this,d=3,b=a;c._editableDiv.focus();if(Sys.Browser.agent!=Sys.Browser.Firefox)if(document.selection){b=document.selection.createRange();b.moveStart("character",d);b.select()}else{b=window.getSelection();b.collapse(c._editableDiv.firstChild,d)}c._textbox._element.value=c._encodeHtml()},_executeCommand:function(f){var i="createLink",d=this;if(f.target.name==undefined)return;var o=Sys.Browser.agent==Sys.Browser.Firefox,k=Function.createDelegate(d,d._colorPicker_onchange);o&&document.execCommand("styleWithCSS",b,b);var r={JustifyRight:1,JustifyLeft:1,JustifyCenter:1,JustifyFull:1,Indent:1,Outdent:1};if(r[f.target.name])try{document.execCommand(f.target.name,b,a)}catch(t){if(t&&t.result==2147500037){var p=window.getSelection().getRangeAt(0),j=document.createElement(g),n=b;j.style.height="1px;";if(p.startContainer.contentEditable=="true"){window.getSelection().collapseToEnd();n=e}var h=window.getSelection().getRangeAt(0).startContainer;while(h&&h.contentEditable!="true")h=h.parentNode;if(!h)throw"Selected node is not editable!";h.insertBefore(j,h.childNodes[0]);document.execCommand(f.target.name,b,a);j.parentNode.removeChild(j);n&&window.getSelection().addRange(p)}else window.console&&window.console.log&&window.console.log(t)}else if(f.target.name==i){var q=prompt("Please insert  URL","");q&&document.execCommand(i,b,q)}else if(f.target.name==l){d._commandName=f.target.name;d.saveSelection();if(!d._foreColorPicker){d._foreColorPicker=$create(Sys.Extended.UI.ColorPickerBehavior,{unselectable:c},{},{},d._foreColor);d._foreColorPicker.set_sample(d._foreColor.parentNode);d._foreColorPicker.add_colorSelectionChanged(k)}d._foreColorPicker.show()}else if(f.target.name==m){d._commandName=f.target.name;d.saveSelection();if(!d._backColorPicker){d._backColorPicker=$create(Sys.Extended.UI.ColorPickerBehavior,{unselectable:c},{},{},d._backColor);d._backColorPicker.set_sample(d._backColor.parentNode);d._backColorPicker.add_colorSelectionChanged(k)}d._backColorPicker.show()}else if(f.target.name=="UnSelect")if(o){d._editableDiv.focus();var s=window.getSelection();s.collapse(d._editableDiv.firstChild,0)}else document.execCommand(f.target.name,b,a);else document.execCommand(f.target.name,b,a)},_colorPicker_onchange:function(c){var a="stylewithcss";this.restoreSelection();if(/backcolor/i.test(this._commandName)){var d=Sys.Browser.agent==Sys.Browser.Firefox;if(d){document.execCommand(a,b,e);document.execCommand("hilitecolor",b,"#"+c._selectedColor);document.execCommand(a,b,b)}else document.execCommand("backcolor",b,"#"+c._selectedColor)}else document.execCommand(this._commandName,b,"#"+c._selectedColor)},saveSelection:function(){if(window.getSelection)this.savedRange=window.getSelection().getRangeAt(0);else if(document.selection)this.savedRange=document.selection.createRange()},restoreSelection:function(){var b=this;b.isInFocus=e;if(b.savedRange!=a)if(window.getSelection){var c=window.getSelection();c.rangeCount>0&&c.removeAllRanges();c.addRange(b.savedRange)}else if(document.createRange)window.getSelection().addRange(b.savedRange);else document.selection&&b.savedRange.select()},get_ButtonWidth:function(){return this._ButtonWidth},set_ButtonWidth:function(a){if(this._ButtonWidth!=a){this._ButtonWidth=a;this.raisePropertyChanged("ButtonWidth")}},get_ButtonHeight:function(){return this._ButtonHeight},set_ButtonHeight:function(a){if(this._ButtonHeight!=a){this._ButtonHeight=a;this.raisePropertyChanged("ButtonHeight")}},get_ToolbarButtons:function(){return this._toolbarButtons},set_ToolbarButtons:function(a){if(this._toolbarButtons!=a){this._toolbarButtons=a;this.raisePropertyChanged(n)}}};Sys.Extended.UI.HtmlEditorExtenderBehavior.registerClass("Sys.Extended.UI.HtmlEditorExtenderBehavior",Sys.Extended.UI.BehaviorBase);Sys.registerComponent(Sys.Extended.UI.HtmlEditorExtenderBehavior,{name:"HtmlEditorExtender",parameters:[{name:n,type:"HtmlEditorExtenderButton[]"}]});Sys.Extended.UI.HtmlEditorExtenderBehavior.WebForm_OnSubmit=function(){var d=Sys.Extended.UI.HtmlEditorExtenderBehavior._originalWebForm_OnSubmit();if(d)for(var b=Sys.Application.getComponents(),a=0;a<b.length;a++){var c=b[a];Sys.Extended.UI.HtmlEditorExtenderBehavior.isInstanceOfType(c)&&c._editableDiv_submit()}return d}}if(window.Sys&&Sys.loader)Sys.loader.registerScript(b,["ExtendedBase","ExtendedCommon"],a);else a()})();