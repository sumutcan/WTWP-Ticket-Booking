// (c) 2010 CodePlex Foundation
(function(){var a=null;function b(){var c=false,h="InternetExplorer",b=true,f="undefined",e="navigate";Type._registerScript("MicrosoftAjaxHistory.js",["MicrosoftAjaxComponentModel.js","MicrosoftAjaxSerialization.js"]);var g,d,i=Sys._isBrowser;g=Sys.HistoryEventArgs=function(a){Sys.HistoryEventArgs.initializeBase(this);this._state=a};g.prototype={get_state:function(){return this._state}};g.registerClass("Sys.HistoryEventArgs",Sys.EventArgs);g=Sys.Application;g._currentEntry="";g._initialState=a;g._state={};d=Sys._Application.prototype;d.get_stateString=function(){var b=a;if(i("Firefox")){var d=window.location.href,c=d.indexOf("#");if(c!==-1)b=d.substring(c+1);else b="";return b}else b=window.location.hash;if(b.length&&b.charAt(0)==="#")b=b.substring(1);return b};d.get_enableHistory=function(){return!!this._enableHistory};d.set_enableHistory=function(a){this._enableHistory=a};d.add_navigate=function(a){this._addHandler(e,a)};d.remove_navigate=function(a){this._removeHandler(e,a)};d.addHistoryPoint=function(g,j){var c=this;c._ensureHistory();var d=c._state;for(var e in g){var h=g[e];if(h===a){if(typeof d[e]!==f)delete d[e]}else d[e]=h}var i=c._serializeState(d);c._historyPointIsNew=b;c._setState(i,j);c._raiseNavigate()};d.setServerId=function(a,b){this._clientId=a;this._uniqueId=b};d.setServerState=function(a){this._ensureHistory();this._state.__s=a;this._updateHiddenField(a)};d._deserializeState=function(a){var e={};a=a||"";var b=a.indexOf("&&");if(b!==-1&&b+2<a.length){e.__s=a.substr(b+2);a=a.substr(0,b)}for(var g=a.split("&"),f=0,j=g.length;f<j;f++){var d=g[f],c=d.indexOf("=");if(c!==-1&&c+1<d.length){var i=d.substr(0,c),h=d.substr(c+1);e[i]=decodeURIComponent(h)}}return e};d._enableHistoryInScriptManager=function(){this._enableHistory=b};d._ensureHistory=function(){var a=this;if(!a._historyInitialized&&a._enableHistory){if(i(h)&&Sys.Browser.documentMode<8){a._historyFrame=Sys.get("#__historyFrame");a._ignoreIFrame=b}a._timerHandler=Function.createDelegate(a,a._onIdle);a._timerCookie=window.setTimeout(a._timerHandler,100);var c;try{a._initialState=a._deserializeState(a.get_stateString())}catch(c){}a._historyInitialized=b}};d._navigate=function(d){var a=this;a._ensureHistory();var c=a._deserializeState(d);if(a._uniqueId){var e=a._state.__s||"",b=c.__s||"";if(b!==e){a._updateHiddenField(b);__doPostBack(a._uniqueId,b);a._state=c;return}}a._setState(d);a._state=c;a._raiseNavigate()};d._onIdle=function(){var a=this;delete a._timerCookie;var b=a.get_stateString();if(b!==a._currentEntry){if(!a._ignoreTimer){a._historyPointIsNew=c;a._navigate(b)}}else a._ignoreTimer=c;a._timerCookie=window.setTimeout(a._timerHandler,100)};d._onIFrameLoad=function(b){var a=this;a._ensureHistory();if(!a._ignoreIFrame){a._historyPointIsNew=c;a._navigate(b)}a._ignoreIFrame=c};d._onPageRequestManagerBeginRequest=function(){this._ignoreTimer=b;this._originalTitle=document.title};d._onPageRequestManagerEndRequest=function(n,m){var d=this,k=m.get_dataItems()[d._clientId],j=d._originalTitle;d._originalTitle=a;var g=Sys.get("#__EVENTTARGET");if(g&&g.value===d._uniqueId)g.value="";if(typeof k!==f){d.setServerState(k);d._historyPointIsNew=b}else d._ignoreTimer=c;var e=d._serializeState(d._state);if(e!==d._currentEntry){d._ignoreTimer=b;if(typeof j==="string"){if(!i(h)||Sys.Browser.version>7){var l=document.title;document.title=j;d._setState(e);document.title=l}else d._setState(e);d._raiseNavigate()}else{d._setState(e);d._raiseNavigate()}}};d._raiseNavigate=function(){var a=this,d=a._historyPointIsNew,c={};for(var b in a._state)if(b!=="__s")c[b]=a._state[b];var f=new Sys.HistoryEventArgs(c);Sys.Observer.raiseEvent(a,e,f);if(!d){var g;try{if(i("Firefox")&&window.location.hash&&(!window.frameElement||window.top.location.hash))Sys.Browser.version<3.5?window.history.go(0):(location.hash=a.get_stateString())}catch(g){}}};d._serializeState=function(d){var c=[];for(var a in d){var e=d[a];if(a==="__s")var b=e;else c.push(a+"="+encodeURIComponent(e))}return c.join("&")+(b?"&&"+b:"")};d._setState=function(e,g){var d=this;if(d._enableHistory){e=e||"";if(e!==d._currentEntry){if(window.theForm){var i=window.theForm.action,j=i.indexOf("#");window.theForm.action=(j!==-1?i.substring(0,j):i)+"#"+e}if(d._historyFrame&&d._historyPointIsNew){d._ignoreIFrame=b;var h=d._historyFrame.contentWindow.document;h.open("javascript:'<html></html>'");h.write("<html><head><title>"+(g||document.title)+'</title><script type="text/javascript">parent.Sys.Application._onIFrameLoad('+Sys.Serialization.JavaScriptSerializer.serialize(e)+");<\/script></head><body></body></html>");h.close()}d._ignoreTimer=c;d._currentEntry=e;if(d._historyFrame||d._historyPointIsNew){var k=d.get_stateString();if(e!==k){window.location.hash=e;d._currentEntry=d.get_stateString();if(typeof g!==f&&g!==a)document.title=g}}d._historyPointIsNew=c}}};d._updateHiddenField=function(b){if(this._clientId){var a=document.getElementById(this._clientId);if(a)a.value=b}}}if(window.Sys&&Sys.loader)Sys.loader.registerScript("History",a,b);else b()})();